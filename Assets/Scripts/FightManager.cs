using UnityEngine;
using UnityEngine.UI;
using UnityEngine.SceneManagement; // ?? ???????? ???????? ???? ?????? ??? ?????????? ???????

public class FightManager : MonoBehaviour
{

@@ -14,14 +15,14 @@ public class FightManager : MonoBehaviour

    private AttackHandler attackHandler;
    private DefenseHandler defenseHandler;

    private bool isDefending = false; // ???? ??????
    private EnemyAttackHandler enemyAttackHandler; // ????? ?????

    void Start()
    {
        // ?????????????
        attackHandler = GetComponentInChildren<AttackHandler>();
        defenseHandler = GetComponentInChildren<DefenseHandler>();
        enemyAttackHandler = GetComponentInChildren<EnemyAttackHandler>();

        attackButton.onClick.AddListener(OnAttackButtonClicked);
        defendButton.onClick.AddListener(OnDefendButtonClicked);

@@ -32,6 + 33,7 @@ public class FightManager : MonoBehaviour

    void Update()
    {
        // ???? ?????????? ????????
        if (Input.GetKeyDown(KeyCode.Q))
        {
            if (Cursor.lockState == CursorLockMode.Locked)

@@ -49,34 +51,66 @@

    public void OnAttackButtonClicked()
    {
        attackHandler.targetCard = enemyCard; // ?????????, ??? targetCard ???????? ?????????
        attackHandler.targetCard = enemyCard;
        attackHandler.PerformAction();
        EndTurn();
        CheckForWinOrLose(); // ????????? ?????? ??? ????????? ????? ?????

        if (enemyCard.health > 0)
        {
            EndTurn(); // ????????? ???, ????? ???? ????????
        }
    }

    public void OnDefendButtonClicked()
    {
        isDefending = true; // ???????? ??????
        defenseHandler.PerformAction(); // ????????? ??????
        EndTurn();
        defenseHandler.playerCard = playerCard; // ????????????? ?????? ? DefenseHandler
        defenseHandler.PerformAction();
        EndTurn(); // ????????? ???, ????? ???? ????????
    }

    private void EndTurn()
    {
        // ?????????? ???? ? ?????? ??? ?????
        if (enemyCard.health > 0)
        {
            attackHandler.targetCard = playerCard; // ???? ??????? ??????
            attackHandler.PerformAction();
            isDefending = false; // ????????? ?????? ????? ?????????? ????
            UpdateCardUI(); // ????????? UI ????? ???????? ?????
            enemyAttackHandler.targetCard = playerCard;
            enemyAttackHandler.PerformAction();
            CheckForWinOrLose(); // ????????? ?????? ??? ????????? ????? ????? ?????
        }

        // ?????????? ?????? ????? ?????????? ???? ?????
        playerCard.defense = 0;

        UpdateCardUI(); // ????????? UI ????? ????????
    }

    private void CheckForWinOrLose()
    {
        if (enemyCard.health <= 0)
        {
            HandleWin();
        }
        else if (playerCard.health <= 0)
        {
            HandleLose();
        }
    }

    private void HandleWin()
    {
        Debug.Log("??????!");
        SceneManager.LoadScene("GnC"); // ?????????? ?????? ?? ???????? ????? ????? ??????
    }

    private void HandleLose()
    {
        Debug.Log("?????????...");
        SceneManager.LoadScene("LoseScene"); // ????????? ????? ?????????
    }

    private void UpdateCardUI()
    {
        playerCardUI.UpdateUI(playerCard);
        enemyCardUI.UpdateUI(enemyCard);
    }
}